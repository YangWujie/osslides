<!DOCTYPE html>
<html lang="zh-cmn-Hans">

<head>
  <meta charset="utf-8" />
  <title>课程简介</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.1.0/reveal.min.css" integrity="sha512-0AUO8B5ll9y1ERV/55xq3HeccBGnvAJQsVGitNac/iQCLyDTGLUBMPqlupIWp/rJg0hV3WWHusXchEIdqFAv1Q==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.1.0/theme/black.min.css" integrity="sha512-B1sAcZ4KSpvbIUUvxaoqy56z88d6fozQyEV54K0gVBUMDMcVu9CAXMwJ5wTWo650j3IQH6yDEETiek6lrk/zCw==" crossorigin="anonymous" referrerpolicy="no-referrer" id="theme" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.1.0/plugin/highlight/monokai.min.css" integrity="sha512-z8wQkuDRFwCBfoj7KOiu1MECaRVoXx6rZQWL21x0BsVVH7JkqCp1Otf39qve6CrCycOOL5o9vgfII5Smds23rg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>
  <div class="reveal">
    <div class="slides">
      <section>
        <h2>操作系统引论</h2>
      </section>

      <section>
        <h2>什么是操作系统？</h2>
        <p>
          操作系统是最基本的系统软件，是一组有效管理和控制计算机硬件和软件资源、合理地对各类作业进行调度以组织和控制系统工作流程，并方便用户使用计算机的程序的集合。
        </p>
      </section>


      <section>
        <p>An operating system (OS) is system software that manages computer hardware, software resources, and provides
          common services for computer programs.
        </p>
      </section>

      <section>
        <h2>操作系统的目标</h2>
        <ol>
          <li>方便性</li>
          <li>有效性</li>
          <li>可扩充性</li>
          <li>开放性</li>
        </ol>
      </section>

      <section>
        <h2>操作系统的作用</h2>
        <ol>
          <li>OS作为用户与计算机硬件系统之间的接口</li>
          <li>OS作为计算机系统资源的管理者</li>
          <li>OS实现了对计算机资源的抽象</li>
        </ol>
      </section>

      <section>
        <h2>操作系统作为接口的示意图</h2>
        <img src="assets/OS作为接口的示意图.jpg" alt="OS作为接口的示意图">
      </section>

      <section>
        <h2>很可惜，教材展示的第一张图就是错的！</h2>
        错误原因，我随后说明
      </section>

      <section>
        <h2>OS作为计算机系统资源的管理者</h2>
        <ol>
          <li>CPU</li>
          <li>内存</li>
          <li>I/O设备</li>
          <li>文件</li>
        </ol>
      </section>

      <section>
        <h2>OS实现了对计算机资源的抽象</h2>
        <img src="assets/1-2.jpg" alt="I/O软件隐藏了I/O操作实现的细节">
      </section>

      <section>
        <h2>推动操作系统发展的主要动力</h2>
        <ol>
          <li>不断提高计算机资源利用率</li>
          <li>方便用户</li>
          <li>器件的不断更新换代</li>
          <li>计算机体系结构的不断发展</li>
          <li>不断提出新的应用需求</li>
        </ol>
      </section>

      <section>
        <h2>操作系统、浏览器，以及微信之间有什么异同？</h2>
      </section>

      <section>
        <ul>
          <li>不同之处：所处位置不同</li>
          <li>相同之处：都可以在其之上开发程序</li>
        </ul>
      </section>

      <section>
        <ul>
          <li>向下管理资源</li>
          <li>向上提供服务</li>
          <li>提供了一个虚拟的计算环境</li>
        </ul>
      </section>

      <section>
        <ul>
          <li>本质上，它们都有封装和抽象的作用：隐藏底层的细节，以不同的面目示人</li>
          <li>或者说，是给底层的基础设施套上了马甲</li>
          <li>马甲可以层层叠加</li>
        </ul>
      </section>

      <section>
        <img src="assets/virtual_machine.png" alt="虚拟机">
      </section>

      <section>
        <img src="assets/俄罗斯套娃.jpeg" alt="俄罗斯套娃">
      </section>

      <section>
        <h2>操作系统的基本特征</h2>
        <ol>
          <li>并发</li>
          <li>共享</li>
          <li>虚拟</li>
          <li>异步</li>
        </ol>
      </section>

      <section>
        <h2>Operating Systems in Three Easy Pieces</h2>
        <ul>
          <li>virtualization</li>
          <li>concurrency</li>
          <li>persistence</li>
        </ul>
      </section>

      <section data-markdown>
        <script type="text/template">
          ## C语言Hello Wrold程序

          ```C
            #include <stdio.h>

            int main()
            {
                printf("Hello, World!\n");
                return 0;
            }
          ```

          ```Bash
          gcc hello.c -o hello
          ./hello
          ```
        </script>
      </section>

      <section>
        <h2>从程序员的角度看</h2>
        <ul>
          <li>每个程序有可以执行代码的CPU，有能用来存储数据和代码的存储空间</li>
          <li>多个程序可以并发执行</li>
          <li>每个程序有自己的输入输出设备</li>
        </ul>
      </section>

      <section data-markdown>
        <script type="text/template">
          ## cpu.c
          ```C
            #include <stdio.h>
            #include <stdlib.h>
            #include <sys/time.h>
            #include <sys/stat.h>
            #include <assert.h>
                
            double GetTime() {
              struct timeval t;
              int rc = gettimeofday(&t, NULL);
              assert(rc == 0);
              return (double) t.tv_sec + (double) t.tv_usec/1e6;
            }
            
            void Spin(int howlong) {
              double t = GetTime();
              while ((GetTime() - t) < (double) howlong)
              ; // do nothing in loop
            }
            
            int main(int argc, char *argv[])
            {
              if (argc != 2) {
                fprintf(stderr, "usage: cpu <string>\n");
                exit(1);
              }
              char *str = argv[1];
            
              while (1) {
                printf("%s\n", str);
                Spin(1);
              }
              return 0;
            }
          ```
        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ```Bash
          gcc cpu.c -o cpu
          ./cpu "A"
          ```
          该程序运行后，每隔1秒打印一个“A”并换行。
          
          按 <kbd>Ctrl</kbd> + <kbd>c</kbd> 可结束程序。
        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ```Bash
          ./cpu "A" & ./cpu "B" & ./cpu "C" & ./cpu "D" &
          ```
        </script>
      </section>

      <section>
        <ul>
          <li>这个程序同时可以启动很多次</li>
          <li>虽然物理CPU数目有限，但貌似每个运行的程序都拥有自己的CPU</li>
          <li>每个运行的程序都有自己的内存</li>
          <li>每个运行的程序都有自己的输入输出设备</li>
        </ul>
      </section>

      <section>
        <h1>虚拟</h1>
        操作系统是如何做到的？
      </section>

      <section data-markdown>
        <script type="text/template">
          ## mem.c
          ```C
          #include <unistd.h>
          #include <stdio.h>
          #include <stdlib.h>
          #include <assert.h>
          
          int main(int argc, char *argv[]) {
              if (argc != 2) { 
                  fprintf(stderr, "usage: mem <value>\n"); 
                  exit(1); 
              } 
              int *p; 
              p = malloc(sizeof(int));
              assert(p != NULL);
              printf("(%d) addr pointed to by p: %p\n", (int) getpid(), p);
              *p = atoi(argv[1]); // assign value to addr stored in p
              while (1) {
                  sleep(1);
                  *p = *p + 1;
                  printf("(%d) value of p: %d\n", getpid(), *p);
              }
              return 0;
          }
          ```
        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ```Bash
          gcc mem.c -o mem
          ./mem "100"
          ```
          该程序运行后，每隔1秒打印一行信息，其中包括进程号及某个内存单元中的值。
          
          按 <kbd>Ctrl</kbd> + <kbd>c</kbd> 可结束程序。
        </script>
      </section>

      <section>
        <h2><a href="https://en.wikipedia.org/wiki/Address_space_layout_randomization">Address Space Layout
            Randomization</a></h2>
        运行mem之前，首先禁用Linux的ASLR。命令如下：
        <pre>echo 0 | sudo tee /proc/sys/kernel/randomize_va_space</pre>
        详细信息请参考：<a
          href="https://askubuntu.com/questions/318315/how-can-i-temporarily-disable-aslr-address-space-layout-randomization">How
          can I temporarily disable ASLR?</a>
      </section>

      <section>
        <h2>./mem 100</h2>
        <pre>
          (16712) addr pointed to by p: 0x555555756260
          (16712) value of p: 101
          (16712) value of p: 102
          (16712) value of p: 103
          (16712) value of p: 104
          (16712) value of p: 105
          (16712) value of p: 106
          (16712) value of p: 107
          (16712) value of p: 108
        </pre>
      </section>

      <section>
        <h2>./mem 1</h2>
        <pre>
          (16815) addr pointed to by p: 0x555555756260
          (16815) value of p: 2
          (16815) value of p: 3
          (16815) value of p: 4
          (16815) value of p: 5
          (16815) value of p: 6
          (16815) value of p: 7
          (16815) value of p: 8
          (16815) value of p: 9
        </pre>
      </section>

      <section>
        <ul>
          <li>相同的地址，不同的数据：虚拟存储器</li>
          <li>输入输出设备也是虚拟的</li>
        </ul>
      </section>

      <section data-markdown>
        <script type="text/template">
          ## threads.c
          ```C
            #include <stdio.h>
            #include <stdlib.h>
            #include <pthread.h>
            
            volatile int counter = 0; 
            int loops;
            
            void *worker(void *arg) {
              int i;
              for (i = 0; i < loops; i++) {
                counter++;
              }
              return NULL;
            }
            
            int main(int argc, char *argv[]) {
              if (argc != 2) { 
                fprintf(stderr, "usage: threads <loops>\n"); 
                exit(1); 
              } 
              loops = atoi(argv[1]);
              pthread_t p1, p2;
              printf("Initial value : %d\n", counter);
              pthread_create(&p1, NULL, worker, NULL); 
              pthread_create(&p2, NULL, worker, NULL);
              pthread_join(p1, NULL);
              pthread_join(p2, NULL);
              printf("Final value   : %d\n", counter);
              return 0;
            }
          ```
        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ```Bash
          gcc threads.c -o threads -lpthread
          ```
        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ## 依次执行如下命令，会得到什么结果？
          ```Bash
          ./thread 10
          ./thread 100
          ./thread 1000
          ./thread 10000
          ./thread 100000
          ```
        </script>
      </section>

    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.1.0/reveal.min.js" integrity="sha512-sMRSj1Ns64C2OE6VNS7WrV63OHW7dLAvi96CXRoy9AEe/tKF+868fhUJpc5ZKS166lwhe2ArCYjFitLJUY+VWA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.1.0/plugin/highlight/highlight.min.js" integrity="sha512-xkVKkN0o7xECTHSUZ9zdsBYRXiAKH7CZ3aICpW6aQJZsufVVRLhEBTDjTpC1tPzm+gNZiOeW174zXAB2fOLsTg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.1.0/plugin/markdown/markdown.min.js" integrity="sha512-4exkEeyVuaWUFKozXl6L3UCugl6ai1cKnrVFkWUstdrNB2sDxxmPEaHBzTlYm9wX78EjPzEBG0s8k37oPeUFIw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    Reveal.initialize({
      plugins: [RevealMarkdown, RevealHighlight]
    });
  </script>
</body>

</html>